function ZijingCardGame(a){this.configObject={};this.settings={toolContainer:"#toolContainer",randomizeStatments:!0,sContinue:"OK,CONTINUE",clkEvtEnabled:!0,keyEventEnabled:!1,scaleConfig:{contentType:"image",isLabelAdded:!0,extention:"_35px.png",splitor:"$",invalid:null,theme:{code1:"green",code2:"red"},keyChars:["A","L"],keyCodes:[90,77]},itemConfig:{contentType:"text",durationShow:400,durationHide:400,maxSecond:null,clickFixOnErr:!0},progressConfig:{bShow:!0,postfix:""},timerConfig:{bShow:!0,postfix:"sec"},
showTest:!1,sError:{displayTime:800,bItemLoad:"Please only press the key after the statement is loaded.",sTimeout:"Sorry, too slow"}};$.extend(!0,this.configObject,a);$.extend(!0,this.settings,this.configObject);this.settings.oOriglabels=[["1","2"],["\u5bf9$icon_good","\u9519$icon_bad"]];this.settings.olabels=[[],[]];for(a=0;a<this.settings.oOriglabels[0].length;a++){var b=!0;null!=this.settings.scaleConfig.invalid&&parseInt(this.settings.oOriglabels[0][a])==this.settings.scaleConfig.invalid&&(b=
!1);b&&(this.settings.olabels[0].push(this.settings.oOriglabels[0][a]),this.settings.olabels[1].push(this.settings.oOriglabels[1][a]))}this.uiElm={items:[],scales:[],keyboards:[]};this.itemRange={start1:{endIndex:this.settings.oCardItems[0].length/2},start2:{endIndex:this.settings.oCardItems[0].length}};this.settings.iTotalItems=this.settings.oCardItems[0].length;this.settings.iTotalScales=this.settings.olabels[0].length;this.settings.iTotalScaleImgLoaded=0;this.settings.currentItemIndex=0;this.settings.toolReady=
!1;this.settings.keyEventEnabled=!1;this.settings.statementEnabled=!1;this.settings.timerCounter=0;this.settings.tCoutner;this.iWrongCounter=this.iCorrectCounter=0;this.iHighestTime=-1;this.build();return this}
ZijingCardGame.prototype.build=function(){this.uiElm.progressArea=$("<div>",{"class":"progress-area hidden block container-fluid"}).appendTo($(this.settings.toolContainer));this.uiElm.progressRow=$("<div>",{"class":"row"}).appendTo(this.uiElm.progressArea);this.settings.timerConfig.bShow&&(this.uiElm.timercol=$("<div>",{"class":"timer-col col-xs-4 col-xs-offset-5"}).appendTo(this.uiElm.progressRow),this.uiElm.timerRow=$("<div>",{"class":"row"}).appendTo(this.uiElm.timercol),this.uiElm.timerIndicator=
$("<div>",{"class":"timer col-xs-9 col-sm-8 col-lg-6 col-lg-offset-3"}).appendTo(this.uiElm.timerRow),this.uiElm.timerTXT=$("<div>",{"class":"timer-postfix col-xs-3"}).html(this.settings.timerConfig.postfix).appendTo(this.uiElm.timerRow),this.remvClass(this.uiElm.progressArea,"hidden"));this.settings.progressConfig.bShow&&(this.uiElm.progressTXT=$("<div>",{"class":"progress-text col-xs-2"}).html(this.getProgressTXT()).appendTo(this.uiElm.progressRow),this.settings.timerConfig.bShow?this.uiElm.progressTXT.addClass("col-xs-offset-1"):
this.uiElm.progressTXT.addClass("col-xs-offset-11"),this.remvClass(this.uiElm.progressArea,"hidden"));this.uiElm.statements=$("<div>",{"class":"statements block"}).appendTo($(this.settings.toolContainer));null!=this.settings.itemConfig.maxSecond&&(this.uiElm.ErrorMsg=$('<div class="err-statement hidden"><span></span></div>').find("span").html(this.settings.sError.sTimeout).end().appendTo(this.uiElm.statements));this.uiElm.scaleContainer=$("<div>",{"class":"scale-container container-fluid block"}).appendTo($(this.settings.toolContainer));
null!=this.settings.sStart&&(this.uiElm.startRow=$("<div>",{"class":"start-row row block"}).appendTo($(this.uiElm.scaleContainer)),this.uiElm.startButton=$("<div>",{"class":"start-button tool-button block",id:"start1",type:1}).html(this.settings.sStart).appendTo(this.uiElm.startRow),this.uiElm.startButtonTwo=$("<div>",{"class":"start-button tool-button block",id:"start2",type:2}).html(this.settings.sStartTwo).appendTo(this.uiElm.startRow),this.settings.itemConfig.clickFixOnErr&&(this.uiElm.continueButton=
$("<div>",{"class":"continue-button tool-button block"}).html(this.settings.sContinue).appendTo(this.uiElm.startRow).hide()));this.uiElm.scaleRow=$("<div>",{"class":"scale-row row block"}).appendTo($(this.uiElm.scaleContainer));if(this.settings.keyEventEnabled){this.uiElm.keyContainer=$("<div>",{"class":"key-container container-fluid block"}).appendTo($(this.settings.toolContainer));this.uiElm.keyRow=$("<div>",{"class":"key-row row block"}).appendTo(this.uiElm.keyContainer);for(var a=0;a<this.settings.olabels[0].length;a++)this.createKeys(a,
this.uiElm.keyRow)}for(a=0;a<this.settings.olabels[0].length;a++)this.createScaleButton(a,this.settings.olabels[0][a],this.settings.olabels[1][a],this.uiElm.scaleRow);this.uiElm.title=$("<div>",{"class":"title-container container-fluid block"}).html(this.settings.sTitle).appendTo($(this.settings.toolContainer))};
ZijingCardGame.prototype.getProgressTXT=function(){var a=this.settings.currentItemIndex,b=this.settings.iTotalItems;this.settings.showTest?--b:a=this.settings.currentItemIndex+1;return a+"/"+b+this.settings.progressConfig.postfix};ZijingCardGame.prototype.remvClass=function(a,b){a.hasClass(b)&&a.removeClass(b)};
ZijingCardGame.prototype.createKeys=function(a,b){this.uiElm.keyboards[a]={};this.uiElm.keyboards[a].col=$("<div>",{"class":"col col-xs-6 block"}).appendTo(b);0==a?this.uiElm.keyboards[a].col.addClass("first"):a==this.settings.olabels[0].length-1&&this.uiElm.keyboards[a].col.addClass("last");this.uiElm.keyboards[a].body=$("<div>",{"class":"key-body transparent block"}).html(this.settings.scaleConfig.keyChars[a]).appendTo(this.uiElm.keyboards[a].col)};
ZijingCardGame.prototype.createScaleButton=function(a,b,c,d){var e=this;this.uiElm.scales[a]={};this.uiElm.scales[a].col=$("<div>",{"class":"col col-xs-6 block"}).appendTo(d);0==a?this.uiElm.scales[a].col.addClass("first"):a==this.settings.olabels[0].length-1&&this.uiElm.scales[a].col.addClass("last");this.uiElm.scales[a].body=$("<div>",{"class":"scale-body transparent block",code:b,iOrder:a}).appendTo(this.uiElm.scales[a].col);this.uiElm.scales[a].contentBox=$("<div>",{"class":"scale-contentbox block"}).appendTo(this.uiElm.scales[a].body);
null!=this.settings.scaleConfig.theme&&this.uiElm.scales[a].contentBox.addClass(e.getScaletheme(b));"image"==this.settings.scaleConfig.contentType.toLowerCase()&&(this.settings.scaleConfig.isLabelAdded?(b=c.split(this.settings.scaleConfig.splitor),$("<img>",{"class":"scale-image img-responsive"}).appendTo(this.uiElm.scales[a].contentBox).one("load",function(){e.scaleImageLoaded($(this))}).attr("src",this.settings.imagePath+b[1]+this.settings.scaleConfig.extention),this.uiElm.scales[a].label=$("<label>",
{"class":"scale-label block"}).html(b[0]).appendTo(this.uiElm.scales[a].body)):$("<img>",{"class":"scale-image img-responsive"}).appendTo(this.uiElm.scales[a].contentBox).one("load",function(){e.scaleImageLoaded($(this))}).attr("src",this.settings.imagePath+c+this.settings.scaleConfig.extention));this.uiElm.scales[a].ticker=$("<div>",{"class":"scale-ticker block fade"}).appendTo(this.uiElm.scales[a].body)};
ZijingCardGame.prototype.getScaletheme=function(a){return this.settings.scaleConfig.theme["code"+a]};ZijingCardGame.prototype.scaleImageLoaded=function(a){var b=(a.parent().height()-a.height())/2,c=(a.parent().width()-a.width())/2;a.css("top",b+"px").css("left",c+"px");this.settings.iTotalScaleImgLoaded++;this.checkImageLoaded()};
ZijingCardGame.prototype.checkImageLoaded=function(){var a=this;this.settings.iTotalScaleImgLoaded>=this.settings.iTotalScales&&(null==this.settings.sStart?this.deployTool(1E3):(this.uiElm.startRow.show(),$(".start-button").click(function(){$(this).hide();$(this).parent().hide();a.createStatements($(this).attr("id"));a.deployTool(0)}),this.settings.itemConfig.clickFixOnErr&&this.uiElm.continueButton.click(function(){a.hideErr();a.hideStatement()})),this.settings.keyEventEnabled&&this.addKeyEvent(),
this.settings.clkEvtEnabled&&this.addClickEvent())};
ZijingCardGame.prototype.createStatements=function(a){for(var b=[],c=0;c<this.itemRange[a].endIndex;c++)b.push(c+1);a=this.settings.randomizeStatments?this.shuffle(b):b;b=[[],[],[],[],[]];for(c=0;c<a.length;c++){var d=this.isInArray(this.settings.oCardItems[0],a[c]);-1<d&&(b[0][c]=this.settings.oCardItems[0][d],b[1][c]=this.settings.oCardItems[1][d],b[2][c]=this.settings.oCardItems[2][d],b[3][c]=this.settings.oCardItems[3][d],b[4][c]=this.settings.oCardItems[4][d])}this.settings.oItems=b;this.settings.iTotalItems=
this.settings.oItems[0].length;for(a=0;a<this.settings.oItems[0].length;a++)this.uiElm.items[a]=$('<div class="statement transparent"><span></span></div>').attr("data-id",this.settings.oItems[0][a]).find("span").html(this.settings.oItems[1][a]).addClass("level"+this.settings.oItems[4][a]).end().appendTo(this.uiElm.statements),this.uiElm.items[a].isWrong=!1,this.uiElm.items[a].iTimer={start:0,end:0,elapsed:0}};
ZijingCardGame.prototype.shuffle=function(a){for(var b=a.length,c,d;0!==b;)d=Math.floor(Math.random()*b),--b,c=a[b],a[b]=a[d],a[d]=c;return a};ZijingCardGame.prototype.isInArray=function(a,b){for(var c=-1,d=0;d<a.length;d++)if(parseInt(a[d])==parseInt(b)){c=d;break}return c};
ZijingCardGame.prototype.deployTool=function(a){var b=this;this.uiElm.progressTXT.css("visibility","visible");for(var c=0;c<this.settings.olabels[0].length;c++)this.uiElm.scales[c].body.removeClass("transparent").addClass("hard"),this.settings.keyEventEnabled&&this.uiElm.keyboards[c].body.removeClass("transparent").addClass("hard");0<a?setTimeout(function(){b.showStatement()},a):b.showStatement()};
ZijingCardGame.prototype.showStatement=function(){for(var a=this,b=0;b<this.settings.olabels[0].length;b++)this.uiElm.scales[b].ticker.removeClass("in");a.uiElm.progressTXT.html(a.getProgressTXT());this.uiElm.items[this.settings.currentItemIndex].animate({left:0,opacity:1},{duration:this.settings.itemConfig.durationShow,complete:function(){a.settings.statementEnabled=!0;a.startCounter();a.uiElm.items[a.settings.currentItemIndex].iTimer.start=(new Date).getTime()}})};
ZijingCardGame.prototype.hideStatement=function(){var a=this;this.uiElm.items[this.settings.currentItemIndex].animate({left:"100%",opacity:0},{duration:this.settings.itemConfig.durationHide,complete:function(){a.settings.currentItemIndex++;a.settings.currentItemIndex<a.settings.oItems[0].length?a.showStatement():a.displayTestResult()}})};
ZijingCardGame.prototype.displayTestResult=function(){$("#toolContainer").hide();$("#test-result").show();for(var a=0,b=0;b<this.uiElm.items.length;b++)a+=1E3*parseFloat(this.uiElm.items[b].iTimer.elapsed);b=Math.round(a/this.settings.oItems[0].length)/1E3;$(".correctCounter").html(this.iCorrectCounter);$(".wrongCounter").html(this.iWrongCounter);$(".timeCounter").html(b);$(".highCounter").html(this.iHighestTime);if(0<this.iWrongCounter){$(".wrong-words-wrapper").show();a="col-xs-3";switch(this.iWrongCounter){case 1:a=
"col-xs-12";break;case 2:a="col-xs-6";break;case 3:a="col-xs-4"}for(b=0;b<this.uiElm.items.length;b++)this.uiElm.items[b].isWrong&&$('<div class="character col"></div>').attr("data-id",this.settings.oItems[0][b]).html(this.settings.oItems[1][b]).addClass("level"+this.settings.oItems[4][b]).addClass(a).appendTo($(".wrong-words-wrapper .row"))}};
ZijingCardGame.prototype.startCounter=function(){var a=this;this.settings.timerCounter=0;a.updateTimerTXT(this.settings.timerCounter);this.settings.tCoutner=setTimeout(function(){a.updateCounter()},100)};
ZijingCardGame.prototype.updateCounter=function(){var a=this;this.settings.timerCounter++;var b=100*this.settings.timerCounter,c=(new Date).getTime()-a.uiElm.items[a.settings.currentItemIndex].iTimer.start;b=0<c-b?c-b:0;c=!0;this.settings.itemConfig.maxSecond&&(c=this.validateTimer());c?(a.updateTimerTXT(this.settings.timerCounter),clearTimeout(a.settings.tCoutner),this.settings.tCoutner=setTimeout(function(){a.updateCounter()},100-b)):(a.settings.statementEnabled=!1,a.showErr(),clearTimeout(a.settings.tCoutner),
a.getTimeLag(a),a.codeInvalidAnswer(),b=!1,a.settings.itemConfig.clickFixOnErr&&!a.isNotLastItem()&&(b=!0),b&&setTimeout(function(){a.hideErr();a.hideStatement()},a.settings.sError.displayTime))};ZijingCardGame.prototype.isNotLastItem=function(){return this.settings.currentItemIndex<this.settings.iTotalItems-1?!0:!1};ZijingCardGame.prototype.codeInvalidAnswer=function(){};
ZijingCardGame.prototype.showErr=function(){this.uiElm.ErrorMsg.removeClass("hidden");this.settings.itemConfig.clickFixOnErr&&(this.uiElm.scaleRow.hide(),this.uiElm.startRow.show(),this.uiElm.continueButton.hide(),this.isNotLastItem()&&this.uiElm.continueButton.show())};ZijingCardGame.prototype.hideErr=function(){this.uiElm.ErrorMsg.addClass("hidden");this.settings.itemConfig.clickFixOnErr&&(this.uiElm.startRow.hide(),this.isNotLastItem()&&this.uiElm.scaleRow.show())};
ZijingCardGame.prototype.validateTimer=function(){return this.settings.timerCounter>10*this.settings.itemConfig.maxSecond?!1:!0};ZijingCardGame.prototype.clearCounter=function(){this.updateTimerTXT(-1);clearTimeout(this.settings.tCoutner)};ZijingCardGame.prototype.updateTimerTXT=function(a){var b="";0<=a&&(b=this.formatDecimals((99999<a?99999:a)/10,1,".",2));this.uiElm.timerIndicator.html(b)};
ZijingCardGame.prototype.formatDecimals=function(a,b,c,d){if(0>=b)return Math.round(a);var e=Math.pow(10,b);e=String(Math.round(a*e)/e);a=0;if(-1==e.indexOf("."))2==d&&(e+=c,a=b);else{var f=e.split(".");e=f[0]+c;e+=f[1];2==d&&(a=b-f[1].length)}for(b=1;b<=a;b++)e+="0";return e};ZijingCardGame.prototype.addKeyEvent=function(){var a=this;$(document).keyup(function(b){a.KeyEventHandler(b,a)})};
ZijingCardGame.prototype.KeyEventHandler=function(a,b){var c=a.keyCode||a.which;if(b.settings.statementEnabled)for(var d=0;d<b.settings.olabels[0].length;d++)if(c==b.settings.scaleConfig.keyCodes[d]){b.settings.statementEnabled=!1;b.selectItem(b,d);break}};ZijingCardGame.prototype.addClickEvent=function(){for(var a=this,b=0;b<this.settings.olabels[0].length;b++)this.uiElm.scales[b].body.click(function(){a.clickHandler($(this).attr("iOrder"),a)})};
ZijingCardGame.prototype.getTimeLag=function(a){a.uiElm.items[a.settings.currentItemIndex].iTimer.end=(new Date).getTime();a.uiElm.items[a.settings.currentItemIndex].iTimer.elapsed=a.uiElm.items[a.settings.currentItemIndex].iTimer.end-a.uiElm.items[a.settings.currentItemIndex].iTimer.start;a.uiElm.items[a.settings.currentItemIndex].iTimer.elapsed=Math.max(0,a.uiElm.items[a.settings.currentItemIndex].iTimer.elapsed)/1E3};
ZijingCardGame.prototype.selectItem=function(a,b){a.getTimeLag(a);a.uiElm.scales[b].ticker.addClass("in");1==a.settings.olabels[0][b]?this.iCorrectCounter++:(this.uiElm.items[a.settings.currentItemIndex].isWrong=!0,this.iWrongCounter++);a.uiElm.items[a.settings.currentItemIndex].iTimer.elapsed>this.iHighestTime&&(this.iHighestTime=a.uiElm.items[a.settings.currentItemIndex].iTimer.elapsed);a.clearCounter();a.hideStatement()};
ZijingCardGame.prototype.clickHandler=function(a,b){b.settings.statementEnabled&&(b.settings.statementEnabled=!1,b.selectItem(b,a))};